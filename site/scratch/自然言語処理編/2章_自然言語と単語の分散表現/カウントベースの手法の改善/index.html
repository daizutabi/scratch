<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="daizutabi">
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <title>2.4 カウントベースの手法の改善 &mdash; Ivory</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../css/pheasant.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../../.." class="site-name"> Ivory</a>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../../..">Deep Learning自習室</a></li>
                    <li class="toctree-l1"><button class="section nav-item">ゼロから作るDeep Learning</button>
<ul class="subnav">
    <li class="toctree-l2"><button class="section nav-item hide">Ivoryライブラリ</button>
<ul class="subnav hide">
    <li class="toctree-l3"><button class="section nav-item hide">基本機能</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/はじめに/">1 はじめに</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/変数/">1.1 変数</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/レイヤ/">1.2 レイヤ</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/パラメータ/">1.3 パラメータ</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/モデル/">1.4 モデル</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/順伝搬と逆伝搬/">1.5 順伝搬と逆伝搬</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/データセット/">1.6 データセット</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/トレーナー/">1.7 トレーナー</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/基本機能/CUDAによる学習の高速化/">1.8 CUDAによる学習の高速化</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">レイヤ実装</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/はじめに/">2 はじめに</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/SigmoidCrossEntropy/">2.1 SigmoidCrossEntropy</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/SoftmaxCrossEntropy/">2.2 SoftmaxCrossEntropy</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/Sigmoid_ReLU/">2.3 Sigmoid/ReLU</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/Affine/">2.4 Affine</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/Flatten/">2.5 Flatten</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/BatchNormalization/">2.6 BatchNormalization</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/Dropout/">2.7 Dropout</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/Convolution_Pooling/">2.8 Convolution/Pooling</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/MatMul_Embedding/">2.9 MatMul/Embeddingレイヤ</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/MatMulMean/">2.10 MatMulMean</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/EmbeddingMean/">2.11 EmbeddingMean</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/EmbeddingDot/">2.12 EmbeddingDot</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/RNN/">2.13 RNN</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/LSTM/">2.14 LSTM</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/レイヤ実装/Select/">2.15 Select</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">拡張機能</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/拡張機能/はじめに/">3 はじめに</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/拡張機能/Negative_Sampling/">3.1 Negative Sampling</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/拡張機能/TimeDataset/">3.2 TimeDataset</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Ivoryライブラリ/拡張機能/Weight_Tying/">3.3 重み共有</a></li>
</ul></li>
</ul></li>
    <li class="toctree-l2"><button class="section nav-item hide">Deep Learningの理論と実践</button>
<ul class="subnav hide">
    <li class="toctree-l3"><a class="nav-item" href="../../../Deep_Learningの理論と実践/0章_はじめに/">はじめに</a></li>
    <li class="toctree-l3"><button class="section nav-item hide">5章 誤差逆伝搬法</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../../Deep_Learningの理論と実践/5章_誤差逆伝搬法/誤差逆伝搬法の実装/">5.7 誤差逆伝搬法の実装</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">6章 学習に関するテクニック</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../../Deep_Learningの理論と実践/6章_学習に関するテクニック/パラメータの更新/">6.1 パラメータの更新</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Deep_Learningの理論と実践/6章_学習に関するテクニック/重みの初期値/">6.2 重みの初期値</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Deep_Learningの理論と実践/6章_学習に関するテクニック/Batch_Normalization/">6.3 Batch Normalization</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Deep_Learningの理論と実践/6章_学習に関するテクニック/正則化/">6.4 正則化</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../../Deep_Learningの理論と実践/6章_学習に関するテクニック/ハイパーパラメータの検証/">6.5 ハイパーパラメータの検証</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">7章 畳み込みニューラルネットワーク</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../../Deep_Learningの理論と実践/7章_畳み込みニューラルネットワーク/CNNの実装/">7.5 CNNの実装</a></li>
</ul></li>
</ul></li>
    <li class="toctree-l2 current"><button class="section nav-item">自然言語処理編</button>
<ul class="subnav">
    <li class="toctree-l3"><a class="nav-item" href="../../0章_はじめに/">はじめに</a></li>
    <li class="toctree-l3"><button class="section nav-item hide">1章 ニューラルネットワークの復習</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../1章_ニューラルネットワークの復習/ニューラルネットワークで問題を解く/">1.4 ニューラルネットワークで問題を解く</a></li>
</ul></li>
    <li class="toctree-l3 current"><button class="section nav-item">2章 自然言語と単語の分散表現</button>
<ul class="subnav">
    <li class="toctree-l4"><a class="nav-item" href="../カウントベースの手法/">2.3 カウントベースの手法</a></li>
    <li class="toctree-l4 current"><a class="nav-item current" href="./">2.4 カウントベースの手法の改善</a>
<ul class="subnav">
<li class="toctree-l5"><a class="nav-item toc" href="#241">2.4.1 相互情報量</a></li>
<li class="toctree-l5"><a class="nav-item toc" href="#243-svd">2.4.3 SVDによる次元削減</a></li>
<li class="toctree-l5"><a class="nav-item toc" href="#244-ptb">2.4.4 PTBデータセット</a></li>
<li class="toctree-l5"><a class="nav-item toc" href="#245-ptb">2.4.5 PTBデータセットでの評価</a></li>
</ul></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">3章 word2vec</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../3章_word2vec/学習データの準備/">3.3 学習データの準備</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../3章_word2vec/CBOWモデルの実装/">3.4 CBOWモデルの実装</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">4章 word2vecの高速化</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../4章_word2vecの高速化/改良版word2vecの学習/">4.3 改良版word2vecの実装</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">5章 リカレントニューラルネットワーク</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../5章_リカレントニューラルネットワーク/RNNLMの学習と評価/">5.7 RNNLMの学習と評価</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">6章 ゲート付きRNN</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../6章_ゲート付きRNN/LSTMを使った言語モデル/">6.4 LSTMを使った言語モデル</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../6章_ゲート付きRNN/RNNLMのさらなる改善/">6.5 RNNLMのさらなる改善</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../6章_ゲート付きRNN/まとめ/">6.6 まとめ</a></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">7章 RNNによる文章生成</button>
<ul class="subnav hide">
    <li class="toctree-l4"><a class="nav-item" href="../../7章_RNNによる文章生成/言語モデルを使った文章生成/">7.1 言語モデルを使った文章生成</a></li>
    <li class="toctree-l4"><a class="nav-item" href="../../7章_RNNによる文章生成/seq2seqの実装/">7.3 seq2seqの実装</a></li>
</ul></li>
</ul></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/daizutabi/ivory/" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="../カウントベースの手法/">&laquo; Previous</a></div>
    <div class="next"><a href="../../3章_word2vec/学習データの準備/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../../.." class="site-name"> Ivory</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>ゼロから作るDeep Learning &raquo; </li><li>自然言語処理編 &raquo; </li><li>2章 自然言語と単語の分散表現</li>
</ul>
</nav>
                <div id="content">
<h2 id="24"><span class="pheasant-header"><span class="header"><span class="number">2.4</span> <span class="title">カウントベースの手法の改善</span></span></span></h2>
<p><a href="https://www.oreilly.co.jp/books/9784873118369/">「ゼロから作るDeep Learning ❷」</a>で用意されている関数をそのまま使います。</p>
<h3 id="241"><span class="pheasant-header"><span class="header"><span class="number">2.4.1</span> <span class="title">相互情報量</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import pandas as pd

from ivory.common.util import create_co_matrix, ppmi, preprocess

text = &#34;You say goodbye and I say hello.&#34;
corpus, word_to_id, id_to_word = preprocess(text)
vocab_size = len(word_to_id)
C = create_co_matrix(corpus, vocab_size)
W = ppmi(C)
v = list(id_to_word.values())
df = pd.DataFrame(W, index=v, columns=v)
df</code></pre></div>
<div class="report"><p><span class="count">[1]</span>
<span class="start">2019-06-12 17:40:43</span> (<span class="time">203ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">203ms</span>)</span></p></div></div>

<div class="cell jupyter display"><div class="content"><table class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>you</th>
      <th>say</th>
      <th>goodbye</th>
      <th>and</th>
      <th>i</th>
      <th>hello</th>
      <th>.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>you</th>
      <td>0.000000</td>
      <td>1.807355</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>say</th>
      <td>1.807355</td>
      <td>0.000000</td>
      <td>0.807355</td>
      <td>0.000000</td>
      <td>0.807355</td>
      <td>0.807355</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>goodbye</th>
      <td>0.000000</td>
      <td>0.807355</td>
      <td>0.000000</td>
      <td>1.807355</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>and</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.807355</td>
      <td>0.000000</td>
      <td>1.807355</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>i</th>
      <td>0.000000</td>
      <td>0.807355</td>
      <td>0.000000</td>
      <td>1.807355</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>hello</th>
      <td>0.000000</td>
      <td>0.807355</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.807355</td>
    </tr>
    <tr>
      <th>.</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.807355</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table></div></div></div></div>

<h3 id="243-svd"><span class="pheasant-header"><span class="header"><span class="number">2.4.3</span> <span class="title">SVDによる次元削減</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import numpy as np

U, S, V = np.linalg.svd(W)
print(C[0])
print(W[0])
print(U[0])</code></pre></div>
<div class="report"><p><span class="count">[2]</span>
<span class="start">2019-06-12 17:40:43</span> (<span class="time">31.2ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">234ms</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">[0 1 0 0 0 0 0]
[0.        1.8073549 0.        0.        0.        0.        0.       ]
[ 0.0000000e+00  3.4094876e-01 -1.2051624e-01 -3.8857806e-16
 -1.1102230e-16 -9.3232495e-01 -2.4257469e-17]</code></pre></div></div></div></div>

<p>プロットしてみます。 </p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import matplotlib.pyplot as plt

for word, word_id in word_to_id.items():
    plt.annotate(word, (U[word_id, 0], U[word_id, 1]))
plt.scatter(U[:, 0], U[:, 1], alpha=0.5)
plt.show()</code></pre></div>
<div class="report"><p><span class="count">[4]</span>
<span class="start">2019-06-12 17:40:43</span> (<span class="time">141ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">500ms</span>)</span></p></div></div>

<div class="cell jupyter display"><div class="content"><p><img alt="image/png" src="data:image/png;base64,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
"/></p></div></div></div></div>

<h3 id="244-ptb"><span class="pheasant-header"><span class="header"><span class="number">2.4.4</span> <span class="title">PTBデータセット</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">from ivory.utils.repository import import_module

ptb = import_module(&#34;scratch2/dataset/ptb&#34;)
corpus, word_to_id, id_to_word = ptb.load_data(&#34;train&#34;)
len(corpus)</code></pre></div>
<div class="report"><p><span class="count">[5]</span>
<span class="start">2019-06-12 17:40:44</span> (<span class="time">31.3ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">531ms</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">929589</code></pre></div></div></div></div>

<h3 id="245-ptb"><span class="pheasant-header"><span class="header"><span class="number">2.4.5</span> <span class="title">PTBデータセットでの評価</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">from sklearn.utils.extmath import randomized_svd
from ivory.common.util import most_similar

window_size = 2
wordvec_size = 100
vocab_size = len(word_to_id)

print(&#34;counting  co-occurrence ...&#34;)
C = create_co_matrix(corpus, vocab_size, window_size)
print(&#34;calculating PPMI ...&#34;)
W = ppmi(C, verbose=True)

print(&#34;calculating SVD ...&#34;)
U, S, V = randomized_svd(W, n_components=wordvec_size, n_iter=5, random_state=None)

word_vecs = U[:, :wordvec_size]

querys = [&#34;you&#34;, &#34;year&#34;, &#34;car&#34;, &#34;toyota&#34;]
for query in querys:
    most_similar(query, word_to_id, id_to_word, word_vecs, top=5)</code></pre></div>
<div class="report"><p><span class="count">[6]</span>
<span class="start">2019-06-12 17:40:44</span> (<span class="time">5min29s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5min29s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">counting  co-occurrence ...
calculating PPMI ...</code></pre></div></div><div class="cell jupyter stderr"><div class="code">
      <pre><code class="nohighlight">C:\Users\daizu\Documents\GitHub\ivory\ivory\common\util.py:115: RuntimeWarning: overflow encountered in long_scalars
  pmi = np.log2(C[i, j] * N / (S[j] * S[i]) + eps)
C:\Users\daizu\Documents\GitHub\ivory\ivory\common\util.py:115: RuntimeWarning: invalid value encountered in log2
  pmi = np.log2(C[i, j] * N / (S[j] * S[i]) + eps)</code></pre></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">1.0% done
2.0% done
3.0% done
4.0% done
5.0% done
6.0% done
7.0% done
8.0% done
9.0% done
10.0% done
11.0% done
12.0% done
13.0% done
14.0% done
15.0% done
16.0% done
17.0% done
18.0% done
19.0% done
20.0% done
21.0% done
22.0% done
23.0% done
24.0% done
25.0% done
26.0% done
27.0% done
28.0% done
29.0% done
30.0% done
31.0% done
32.0% done
33.0% done
34.0% done
35.0% done
36.0% done
37.0% done
38.0% done
39.0% done
40.0% done
41.0% done
42.0% done
43.0% done
44.0% done
45.0% done
46.0% done
47.0% done
48.0% done
49.0% done
50.0% done
51.0% done
52.0% done
53.0% done
54.0% done
55.0% done
56.0% done
57.0% done
58.0% done
59.0% done
60.0% done
61.0% done
62.0% done
63.0% done
64.0% done
65.0% done
66.0% done
67.0% done
68.0% done
69.0% done
70.0% done
71.0% done
72.0% done
73.0% done
74.0% done
75.0% done
76.0% done
77.0% done
78.0% done
79.0% done
80.0% done
81.0% done
82.0% done
83.0% done
84.0% done
85.0% done
86.0% done
87.0% done
88.0% done
89.0% done
90.0% done
91.0% done
92.0% done
93.0% done
94.0% done
95.0% done
96.0% done
97.0% done
98.0% done
99.0% done
100.0% done
calculating SVD ...

[query] you
 i: 0.6961897611618042
 we: 0.6631303429603577
 anybody: 0.6072962284088135
 do: 0.5863798260688782
 &#39;ll: 0.5081530213356018

[query] year
 month: 0.6787183880805969
 quarter: 0.6236955523490906
 earlier: 0.6146764159202576
 next: 0.6078804731369019
 last: 0.5858464241027832

[query] car
 luxury: 0.5490508675575256
 auto: 0.5488603711128235
 cars: 0.537540853023529
 midsized: 0.459559828042984
 motor: 0.4571341276168823

[query] toyota
 motor: 0.7791914939880371
 honda: 0.6706029176712036
 nissan: 0.657393753528595
 motors: 0.6424781680107117
 lexus: 0.5998319983482361</code></pre></div></div></div></div></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../カウントベースの手法/" title="2.3 カウントベースの手法"><span>Previous</span></a></div>
        <div class="next"><a href="../../3章_word2vec/学習データの準備/" title="3.3 学習データの準備"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>
        var base_url = '.';
    </script>
    <script src="../../../../js/theme.js"></script>
    <script src="../../../../js/pheasant.js"></script>
</body>

</html>